# 购买CCE集群<a name="cce_10_0028"></a>

您可以通过云容器引擎控制台非常方便快速的创建Kubernetes集群。Kubernetes是大规模容器集群管理软件，一个集群可以管理一组节点资源。

CCE集群支持虚拟机与裸金属服务器混合、支持GPU、NPU等异构节点的混合部署，基于高性能网络模型提供全方位、多场景、安全稳定的容器运行环境，您可以实现多种场景的混合部署。

## 约束与限制<a name="section1386743114294"></a>

-   创建节点过程中会使用域名方式从OBS下载软件包，需要能够使用云上内网DNS解析OBS域名，否则会导致创建不成功。为此，节点所在子网需要配置为[内网DNS地址](https://support.huaweicloud.com/dns_faq/dns_faq_002.html)，从而使得节点使用内网DNS。在创建子网时DNS默认配置为内网DNS，如果您修改过子网的DNS，请务必**确保子网下的DNS服务器可以解析OBS服务域名**，否则需要将DNS改成内网DNS。
-   单Region下单用户可创建的集群总数限制为50个，如果配额不满足业务需求，请[到“我的配额”提交申请](https://console.huaweicloud.com/quota/?locale=zh-cn#/quota)。
-   集群一旦创建以后，不支持变更以下项：
    -   变更集群类型。
    -   变更集群的控制节点数量。
    -   变更控制节点可用区。
    -   变更集群的网络配置，如所在的虚拟私有云VPC、子网、容器网段、服务网段、IPv6、kubeproxy代理（转发）模式。
    -   变更网络模型，例如“容器隧道网络“更换为“VPC网络“。


## 操作步骤<a name="section176228482126"></a>

1.  登录CCE控制台。选择“集群管理“，在右侧页面“CCE集群“下，单击“购买”。
2.  填写集群参数。

    **基础配置**

    -   集群名称。
    -   企业项目：

        该参数仅对开通企业项目的企业客户帐号显示。

        选择某企业项目（如：default）后，集群、集群下节点、集群安全组、节点安全组和自动创建的节点EIP（弹性公网IP）将创建到所选企业项目下。为方便管理资源，在集群创建成功后，建议不要修改集群下节点、集群安全组、节点安全组的企业项目。

        企业项目是一种云资源管理方式，企业项目管理服务提供统一的云资源按项目管理，以及项目内的资源管理、成员管理。了解更多企业项目相关信息，请查看[企业管理](https://support.huaweicloud.com/usermanual-em/zh-cn_topic_0123692049.html)。

    -   集群版本：选择集群使用的Kubernetes版本。
    -   集群规模：集群支持管理的最大节点数量，请根据业务场景选择。
    -   高可用：控制节点分布方式，默认随机分配，控制节点尽可能随机分布在不同可用区以提高容灾能力 。

        您还可以展开高级配置自定义控制节点分布方式，支持如下3种方式。

        -   随机分配：通过把控制节点随机创建在不同的可用区中实现容灾。
        -   自定义：自定义选择每台控制节点的位置。
            -   主机：通过把控制节点创建在相同可用区下的不同主机中实现容灾。
            -   自定义：用户自行决定每台控制节点所在的位置。


    **网络配置**

    集群网络涉及节点、容器和服务，强烈建议您详细了解集群的网络以及容器网络模型，具体请参见[网络概述](网络概述.md)。

    -   网络模型：CCE集群支持“VPC网络“和“容器隧道网络“，详细介绍请参见[VPC网络](VPC网络.md)和[容器隧道网络](容器隧道网络.md)。
    -   虚拟私有云：选择集群所在的虚拟私有云VPC，如没有可选项可以单击右侧“新建虚拟私有云“创建。创建后不可修改。1.15及以上版本容器隧道网络的CCE集群支持开启IPv4/IPv6双栈，具体请参见[如何通过CCE搭建IPv4/IPv6双栈集群？](https://support.huaweicloud.com/bestpractice-cce/cce_bestpractice_00222.html)
    -   控制节点子网：选择控制节点（即集群Master节点）所在子网，如没有可选项可以单击右侧“新建子网“创建。创建后控制节点子网不可修改。
    -   容器网段：设置容器使用的网段。VPC网络模型支持添加多个容器网段，且支持集群创建后添加容器网段。
    -   服务网段：同一集群下容器互相访问时使用的Service资源的网段。决定了Service资源的上限。 创建后不可修改。

    **高级配置**

    -   服务转发模式：支持IPVS和iptables两种转发模式，具体请参见[iptables与IPVS如何选择](iptables与IPVS如何选择.md)。
    -   CPU管理策略：具体请参见[CPU绑核配置](CPU绑核配置.md)。
    -   集群标签：

        通过为资源添加标签，可以对资源进行自定义标记，实现资源的分类。

        您可以在TMS中创建“预定义标签“，预定义标签对所有支持标签功能的服务资源可见，通过使用预定义标签可以提升标签创建和迁移效率。

        KEY字符集规范

        -   key不能为空，长度1\~128个半角字符
        -   \_sys\_开头属于系统标签，租户不能输入
        -   可用 UTF-8 格式表示的字母\(包含中文\)、数字和空格，以及以下字符： \_ . : / = + - @

            建议正则：^\(\(?!\_sys\_\)\[\\\\p\{L\}\\\\p\{Z\}\\\\p\{N\}\_.:\\\\/=+\\\\-@\]\*\)$

        VALUE字符集规范

        -   VALUE长度 0\~255
        -   可用 UTF-8 格式表示的字母\(包含中文\)、数字和空格，以及以下字符： \_ . : / = + - @

            建议正则：^\(\[\\p\{L\}\\p\{Z\}\\p\{N\}\_.:\\/=+\\-@\]\*\)$

        -   资源标签值可以为空（empty or null）
        -   预定义标签值不可以为空

    -   节点默认安全组：您可选择使用CCE自动生成的安全组，或选择已有安全组作为节点默认安全组。

        >![](public_sys-resources/icon-notice.gif) **须知：** 
        >节点默认安全组必须放通指定端口来保证集群内部正常通信，否则将无法成功创建节点，安全组端口配置说明请参考[集群安全组规则配置](https://support.huaweicloud.com/cce_faq/cce_faq_00265.html)。

    -   证书认证：
        -   系统默认：默认开启X509认证模式，X509是一种非常通用的证书格式。
        -   自定义：您可以将自定义证书添加到集群中，用自定义证书进行认证。

            您需要分别上传自己的**CA根证书**、**客户端证书**和**客户端证书私钥**。

            >![](public_sys-resources/icon-caution.gif) **注意：** 
            >-   请上传**小于1MB**的文件，CA根证书和客户端证书上传格式支持**.crt或.cer**格式，客户端证书私钥仅支持上传**未加密的证书私钥**。
            >-   客户端证书有效期需要5年以上。
            >-   上传的CA根证书既给认证代理使用，也用于配置kube-apiserver聚合层，**如不合法，集群将无法成功创建**。


    -   配置管理：

        过载控制（1.23及以上版本集群支持）：开启过载控制后，将根据控制节点的资源压力，动态调整请求并发量，维护控制节点和集群的可靠性。

3.  单击“下一步：插件配置“，配置插件。

    默认安装[CoreDNS](CoreDNS（系统资源插件-必装）.md)和[Everest](Everest（系统资源插件-必装）.md)两个插件。

    **日志采集**

    -   ICAgent日志采集：

        由应用运维服务 AOM 提供的日志采集器，配置采集规则后可同时将日志上报至 AOM 服务和云日志服务 LTS。

        您可以根据需要选择是否采集容器标准输出日志。

    -   不采集：关闭日志采集能力。集群创建后可以前往 CCE 日志管理页面重新开启。

4.  参数填写完成后，在右侧会显示集群资源清单，确认无误后选择支付方式和购买时长。

    -   按需付费：单击“提交“。
    -   包年包月：单击“去支付“，在弹出的页面中单击“确认付款“。

    集群创建预计需要6-10分钟，您可以单击“返回集群管理“进行其他操作或单击“查看集群事件列表“后查看集群详情。


## 相关操作<a name="section125261255139"></a>

-   通过命令行工具连接集群：请参见[通过kubectl连接集群](通过kubectl连接集群.md)。
-   添加节点：集群创建完成后，若您需要为集群添加节点，请参见[创建节点](创建节点.md)。

