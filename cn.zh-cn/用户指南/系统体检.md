# 系统体检<a name="cce_01_0218"></a>

## 操作场景<a name="zh-cn_topic_0000001243351889_section1351062732514"></a>

系统管家主要分为两部分：系统体检和系统加固，本章节主要介绍系统体检。

系统体检主要用于实时检测并发现节点上的一些故障或者异常情况。

## 前提条件<a name="zh-cn_topic_0000001243351889_section168785975413"></a>

-   使用系统体检功能前需安装[npd插件](npd-151.md)，该插件用于检测节点异常。
-   使用系统体检功能前需安装[prometheus插件](prometheus-156.md)，使用该插件可以获取npd上报的异常指标。

## 操作步骤<a name="zh-cn_topic_0000001243351889_section13882195819560"></a>

1.  登录CCE控制台，在左侧导航栏中选择“系统管家  \>  系统体检“。
2.  在系统体检页面左侧“节点“区域单击需要进行系统体检的节点，可以看到指标检查、行为统计和Kubernetes事件三个页签，有如下两种情况：

    **未安装插件：**

    若未安装[npd插件](npd-151.md)和[prometheus插件](prometheus-156.md)，请按照页签下的提示进行安装。

    插件安装完成后，单击“系统管家  \>  系统体检“返回系统体检页面查看体检信息。

    **图 1**  安装系统体检所需插件<a name="zh-cn_topic_0000001243351889_fig1685611812461"></a>  
    ![](figures/安装系统体检所需插件.png "安装系统体检所需插件")

    **已安装插件：**

    若已安装插件，单击指标检查、行为统计和Kubernetes事件三个页签后可直接查看体检信息。

    **图 2**  查看体检信息<a name="zh-cn_topic_0000001243351889_fig06331918114"></a>  
    ![](figures/查看体检信息.png "查看体检信息")

3.  单击“指标检查“页签，可以查看系统资源、系统组件、异常行为和其他信息，并根据体检信息提示进行相应操作。

    **表 1**  创建集群须知

    <a name="zh-cn_topic_0000001243351889_table108111152195919"></a>
    <table><thead align="left"><tr id="zh-cn_topic_0000001243351889_row20811252105914"><th class="cellrowborder" valign="top" width="20.03%" id="mcps1.2.4.1.1"><p id="zh-cn_topic_0000001243351889_p14811135212593"><a name="zh-cn_topic_0000001243351889_p14811135212593"></a><a name="zh-cn_topic_0000001243351889_p14811135212593"></a>检查名称</p>
    </th>
    <th class="cellrowborder" valign="top" width="38.59%" id="mcps1.2.4.1.2"><p id="zh-cn_topic_0000001243351889_p15811452145913"><a name="zh-cn_topic_0000001243351889_p15811452145913"></a><a name="zh-cn_topic_0000001243351889_p15811452145913"></a>检查项</p>
    </th>
    <th class="cellrowborder" valign="top" width="41.38%" id="mcps1.2.4.1.3"><p id="zh-cn_topic_0000001243351889_p1418715362071"><a name="zh-cn_topic_0000001243351889_p1418715362071"></a><a name="zh-cn_topic_0000001243351889_p1418715362071"></a>描述</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="zh-cn_topic_0000001243351889_row88111652155915"><td class="cellrowborder" rowspan="3" valign="top" width="20.03%" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p1298265916593"><a name="zh-cn_topic_0000001243351889_p1298265916593"></a><a name="zh-cn_topic_0000001243351889_p1298265916593"></a>系统资源</p>
    </td>
    <td class="cellrowborder" valign="top" width="38.59%" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p6982145965918"><a name="zh-cn_topic_0000001243351889_p6982145965918"></a><a name="zh-cn_topic_0000001243351889_p6982145965918"></a>磁盘</p>
    </td>
    <td class="cellrowborder" valign="top" width="41.38%" headers="mcps1.2.4.1.3 "><p id="zh-cn_topic_0000001243351889_p131874367719"><a name="zh-cn_topic_0000001243351889_p131874367719"></a><a name="zh-cn_topic_0000001243351889_p131874367719"></a>节点磁盘使用情况</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row1040679473"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p13406592718"><a name="zh-cn_topic_0000001243351889_p13406592718"></a><a name="zh-cn_topic_0000001243351889_p13406592718"></a>内存</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p21873367719"><a name="zh-cn_topic_0000001243351889_p21873367719"></a><a name="zh-cn_topic_0000001243351889_p21873367719"></a>节点内存使用情况</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row94371418277"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p44374181176"><a name="zh-cn_topic_0000001243351889_p44374181176"></a><a name="zh-cn_topic_0000001243351889_p44374181176"></a>PID</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p9187173616713"><a name="zh-cn_topic_0000001243351889_p9187173616713"></a><a name="zh-cn_topic_0000001243351889_p9187173616713"></a>节点PID进程使用情况</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row981135210590"><td class="cellrowborder" rowspan="5" valign="top" width="20.03%" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p199826593596"><a name="zh-cn_topic_0000001243351889_p199826593596"></a><a name="zh-cn_topic_0000001243351889_p199826593596"></a>系统组件</p>
    </td>
    <td class="cellrowborder" valign="top" width="38.59%" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p13827195212710"><a name="zh-cn_topic_0000001243351889_p13827195212710"></a><a name="zh-cn_topic_0000001243351889_p13827195212710"></a>CNI</p>
    </td>
    <td class="cellrowborder" valign="top" width="41.38%" headers="mcps1.2.4.1.3 "><p id="zh-cn_topic_0000001243351889_p1187236371"><a name="zh-cn_topic_0000001243351889_p1187236371"></a><a name="zh-cn_topic_0000001243351889_p1187236371"></a>CNI组件运行情况</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row10303103591119"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p14304173551114"><a name="zh-cn_topic_0000001243351889_p14304173551114"></a><a name="zh-cn_topic_0000001243351889_p14304173551114"></a>DOCKER</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p153048351110"><a name="zh-cn_topic_0000001243351889_p153048351110"></a><a name="zh-cn_topic_0000001243351889_p153048351110"></a>Docker组件运行情况</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row1430443511120"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p230412358118"><a name="zh-cn_topic_0000001243351889_p230412358118"></a><a name="zh-cn_topic_0000001243351889_p230412358118"></a>KUBELET</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p3304535171119"><a name="zh-cn_topic_0000001243351889_p3304535171119"></a><a name="zh-cn_topic_0000001243351889_p3304535171119"></a>Kubelet组件运行情况</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row173042355118"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p17304635171118"><a name="zh-cn_topic_0000001243351889_p17304635171118"></a><a name="zh-cn_topic_0000001243351889_p17304635171118"></a>KUBEPROXY</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p63048357118"><a name="zh-cn_topic_0000001243351889_p63048357118"></a><a name="zh-cn_topic_0000001243351889_p63048357118"></a>Kubeproxy组件运行情况</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row4304133571118"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p15304163511110"><a name="zh-cn_topic_0000001243351889_p15304163511110"></a><a name="zh-cn_topic_0000001243351889_p15304163511110"></a>NTP</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p14304153510119"><a name="zh-cn_topic_0000001243351889_p14304153510119"></a><a name="zh-cn_topic_0000001243351889_p14304153510119"></a>NTP组件运行情况</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row6811952165919"><td class="cellrowborder" rowspan="4" valign="top" width="20.03%" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p1298215925914"><a name="zh-cn_topic_0000001243351889_p1298215925914"></a><a name="zh-cn_topic_0000001243351889_p1298215925914"></a>异常行为</p>
    </td>
    <td class="cellrowborder" valign="top" width="38.59%" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p48269521972"><a name="zh-cn_topic_0000001243351889_p48269521972"></a><a name="zh-cn_topic_0000001243351889_p48269521972"></a>频繁重启Containerd</p>
    </td>
    <td class="cellrowborder" valign="top" width="41.38%" headers="mcps1.2.4.1.3 "><p id="zh-cn_topic_0000001243351889_p15187113620713"><a name="zh-cn_topic_0000001243351889_p15187113620713"></a><a name="zh-cn_topic_0000001243351889_p15187113620713"></a>Containerd频繁重启</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row193915486126"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p16391124891214"><a name="zh-cn_topic_0000001243351889_p16391124891214"></a><a name="zh-cn_topic_0000001243351889_p16391124891214"></a>频繁重启Docker</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p1439134811123"><a name="zh-cn_topic_0000001243351889_p1439134811123"></a><a name="zh-cn_topic_0000001243351889_p1439134811123"></a>Docker频繁重启</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row2039118484122"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p8391174810120"><a name="zh-cn_topic_0000001243351889_p8391174810120"></a><a name="zh-cn_topic_0000001243351889_p8391174810120"></a>频繁重启Kubelet</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p14391124841210"><a name="zh-cn_topic_0000001243351889_p14391124841210"></a><a name="zh-cn_topic_0000001243351889_p14391124841210"></a>Kubelet频繁重启</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row63911648101219"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p1239124831214"><a name="zh-cn_topic_0000001243351889_p1239124831214"></a><a name="zh-cn_topic_0000001243351889_p1239124831214"></a>频繁注销网络设备</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p1239114815123"><a name="zh-cn_topic_0000001243351889_p1239114815123"></a><a name="zh-cn_topic_0000001243351889_p1239114815123"></a>网络设备比如网卡，频繁注销</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row7811135245911"><td class="cellrowborder" valign="top" width="20.03%" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p16982155995917"><a name="zh-cn_topic_0000001243351889_p16982155995917"></a><a name="zh-cn_topic_0000001243351889_p16982155995917"></a>其他</p>
    </td>
    <td class="cellrowborder" valign="top" width="38.59%" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p398225975918"><a name="zh-cn_topic_0000001243351889_p398225975918"></a><a name="zh-cn_topic_0000001243351889_p398225975918"></a>Ready</p>
    </td>
    <td class="cellrowborder" valign="top" width="41.38%" headers="mcps1.2.4.1.3 "><p id="zh-cn_topic_0000001243351889_p161872036072"><a name="zh-cn_topic_0000001243351889_p161872036072"></a><a name="zh-cn_topic_0000001243351889_p161872036072"></a>节点状态是否ready</p>
    </td>
    </tr>
    </tbody>
    </table>

4.  单击“行为统计“页签，可以查看行为信息和行为发生的次数。
5.  单击“Kubernetes事件“页签，可以查看该节点的事件名称、事件类型、发生次数、Kubernetes事件、首次和最近发生的时间。

    >![](public_sys-resources/icon-note.gif) **说明：** 
    >事件保存时间为1小时，1小时后自动清除数据。


## 恢复建议<a name="zh-cn_topic_0000001243351889_section14891134413567"></a>

-   对于系统资源不足，可以到节点上对系统资源进行扩容，或者调整内核参数调大上限。若还是无法恢复节点，可以给节点打上污点标记，使得pod不再调度到该节点，或者驱逐节点上的pod，隔离该节点。
-   对于系统组件异常或者其他异常行为发生也可以采取给节点打上污点标记进行处理。

## 相关参考<a name="zh-cn_topic_0000001243351889_section1598713175217"></a>

-   为节点打污点标记：[Taints and Tolerations](https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/)
-   稳定驱逐：[Safely Drain a Node while Respecting the PodDisruptionBudget](https://kubernetes.io/docs/tasks/administer-cluster/safely-drain-node/)
-   如下三个命令可以保证维护节点时，平滑的将被维护节点上的业务迁移到其他节点上，保证业务不受影响：

    **表 2**  标记节点为可调度或不可调度

    <a name="zh-cn_topic_0000001243351889_table244353324710"></a>
    <table><thead align="left"><tr id="zh-cn_topic_0000001243351889_row184431333184719"><th class="cellrowborder" valign="top" width="20.732073207320735%" id="mcps1.2.4.1.1"><p id="zh-cn_topic_0000001243351889_p644319335474"><a name="zh-cn_topic_0000001243351889_p644319335474"></a><a name="zh-cn_topic_0000001243351889_p644319335474"></a>命令</p>
    </th>
    <th class="cellrowborder" valign="top" width="39.64396439643964%" id="mcps1.2.4.1.2"><p id="zh-cn_topic_0000001243351889_p6443733194714"><a name="zh-cn_topic_0000001243351889_p6443733194714"></a><a name="zh-cn_topic_0000001243351889_p6443733194714"></a>功能</p>
    </th>
    <th class="cellrowborder" valign="top" width="39.62396239623963%" id="mcps1.2.4.1.3"><p id="zh-cn_topic_0000001243351889_p044323316477"><a name="zh-cn_topic_0000001243351889_p044323316477"></a><a name="zh-cn_topic_0000001243351889_p044323316477"></a>用法</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="zh-cn_topic_0000001243351889_row444323344714"><td class="cellrowborder" valign="top" width="20.732073207320735%" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p1044353314715"><a name="zh-cn_topic_0000001243351889_p1044353314715"></a><a name="zh-cn_topic_0000001243351889_p1044353314715"></a>cordon</p>
    </td>
    <td class="cellrowborder" valign="top" width="39.64396439643964%" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p844373319472"><a name="zh-cn_topic_0000001243351889_p844373319472"></a><a name="zh-cn_topic_0000001243351889_p844373319472"></a>标记节点为不可调度</p>
    </td>
    <td class="cellrowborder" valign="top" width="39.62396239623963%" headers="mcps1.2.4.1.3 "><p id="zh-cn_topic_0000001243351889_p2443133374712"><a name="zh-cn_topic_0000001243351889_p2443133374712"></a><a name="zh-cn_topic_0000001243351889_p2443133374712"></a>kubectl cordon {{node-name }}</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row9443123319472"><td class="cellrowborder" valign="top" width="20.732073207320735%" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p7443433134716"><a name="zh-cn_topic_0000001243351889_p7443433134716"></a><a name="zh-cn_topic_0000001243351889_p7443433134716"></a>uncordon</p>
    </td>
    <td class="cellrowborder" valign="top" width="39.64396439643964%" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p944353384711"><a name="zh-cn_topic_0000001243351889_p944353384711"></a><a name="zh-cn_topic_0000001243351889_p944353384711"></a>标记节点为可调度</p>
    </td>
    <td class="cellrowborder" valign="top" width="39.62396239623963%" headers="mcps1.2.4.1.3 "><p id="zh-cn_topic_0000001243351889_p16443333174720"><a name="zh-cn_topic_0000001243351889_p16443333174720"></a><a name="zh-cn_topic_0000001243351889_p16443333174720"></a>kubectl uncordon {{node-name }}</p>
    </td>
    </tr>
    <tr id="zh-cn_topic_0000001243351889_row194441733104720"><td class="cellrowborder" valign="top" width="20.732073207320735%" headers="mcps1.2.4.1.1 "><p id="zh-cn_topic_0000001243351889_p174443330476"><a name="zh-cn_topic_0000001243351889_p174443330476"></a><a name="zh-cn_topic_0000001243351889_p174443330476"></a>drain</p>
    </td>
    <td class="cellrowborder" valign="top" width="39.64396439643964%" headers="mcps1.2.4.1.2 "><p id="zh-cn_topic_0000001243351889_p2444433184713"><a name="zh-cn_topic_0000001243351889_p2444433184713"></a><a name="zh-cn_topic_0000001243351889_p2444433184713"></a>标记节点为不可调度，并驱逐节点上的pod</p>
    </td>
    <td class="cellrowborder" valign="top" width="39.62396239623963%" headers="mcps1.2.4.1.3 "><p id="zh-cn_topic_0000001243351889_p1544414338478"><a name="zh-cn_topic_0000001243351889_p1544414338478"></a><a name="zh-cn_topic_0000001243351889_p1544414338478"></a>kubectl drain {{node-name }}</p>
    </td>
    </tr>
    </tbody>
    </table>


